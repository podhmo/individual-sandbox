# monogusa

- https://github.com/podhmo/monogusa

## 最近のmonogusa

```
$ git ls-files ../../ | xargs dirname | grep -oP ".*example_monogusa$" | sort -u | tac
```

- ../../20191217/example_monogusa
- ../../20191215/example_monogusa
- ../../20191214/example_monogusa
- ../../20191211/example_monogusa

## とりあえず関数の引数定義からのschema生成を

inspect.getfullasrgspecがいつも自分の期待とはちょっと違うものを返す。
そう言えばいっそのことこういうものが欲しいというものをそのまま返すようにしてあげても良いのかもしれない。

とはいえ引数の変換は何度も何度も書いている気がする。

## とりあえずwebの形で動かそうと思った

とりあえずテキトウなコードをfastAPI上に載せる。何度も何度も書くことになるhello world。
依存の依存部分をfastapi用に直していくのが地味にめんどうだと感じたりした。

あと、作った結果を試すのに手元でサーバーを動かして確認するようなコマンドが欲しくなったりしたかも。

## magicalimportをもう少しmagicalに

結局 `here=__file__` と明示的に書く使いかたがほとんどなので。それにmetashapeとかでふつうにstackframeを見るコードが存在してしまっているのでもうデフォルトがコレで良い気がしたので。

たまに使う時に、hereを忘れてcwdを見てしまいハマると言うことがある。

## 結局もう少しコード生成を頑張ろうと

やっぱり配信が一瞬で終わるという形が良いので。手書きのコードがだるい。
それでいろいろ考えていたのだけれど。使う使われるの関係が記述できないとキツイかもしれない。

現状はとりあえず惰性でprestringでの生成を考えていたのだけれど。例えばクラスを定義した時に、このクラスの定義を出力する以外に、このクラス自体を利用した記述を渡したくなる。どういうのモジュールでは単に名前だけ、別モジュール上ではimport付きで呼ばれて欲しい。

このあたりのことを考えると、CodeObjectみたいな形式でクラスを定義してあげた方が良いのかもしれない。

## CodeObjectを作った

そこそこ動くようになった。
後もうひと頑張りしてASTを触るようにすれば`m.stmt()`から解放されるかもしれない。

あと、bainary operatorとかには対応していない。
