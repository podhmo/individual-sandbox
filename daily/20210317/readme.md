## go bytes.Buffer

- Truncateを使ってunwriteを作る
- ReadFromの価値とio.Copyとの差異
- io.Writerで受け取らない方が嬉しい時がある？

## go handmade

環境を見ながらのコード生成がしたい。これをどのようにして取り入れるか？と言うところが悩み。

- その上であまり依存がないような形で動いて欲しい？
- go/typesを再実装しちゃったほうが手軽なのでは？
- go/typesをそのまま使おうとした方が手軽なのでは？

みたいな話があるのか

## handmadeでやりたかった作業を思い出す

- 記憶が確かなら、liftする部分
- structをたどって何かをするのでは不足するんだろうか？
- 生成された関数を使いたいということかもしれない。それだ。

### 生成されたコードを利用するコード

- genericsとかぶるか？というと微妙に違う
  - hygeneric macro的な性質がある
  - 新たなsymbolを生成することが出来ない
- 何を生成するのか？
  - メソッドを生成する (interfaceを満たすようにする)
  - 実装を生成する
- 部品を生成して、統合する部分を作りたいと言うような感覚がある？
  - しかしそれはどこなのだろうか？
  - handler部分？
- scaffoldではなぜダメなんだろうか？
  - 欲しいのは生成ではない。
  - 既存の定義が変更になったときに適用したい
  - 常にそれが欲しいというわけではない
- イメージはわかったがどこで使うんだろうか？
  - genericsは実装自体を埋め込むもの
  - genericsで対応出来ないのは入力から生成された像のようなものを扱うとき


思うこと

- fmt.Stringerのようなインターフェイスを満たす系のものは、生成対象をメソッドにしているので依存がない
- go-swaggerやgoaなどは必要なもののフルセットを生成し、統合はユーザーに任せるので不要
- 何がしたいか？というとレガシーなコードへの適用。この場合は既存の定義を使い回すことになる。
- 既存の定義を使い回すことの一例としてはmodel側のコードを露出する事が挙げられる

  - presentation modelを作るか作らないかは判断が分かれるところではある
  - 初回は作らない方が開発効率が上がるのではないか？と言う面がある

### 追記

実装に入ってみる。つまるところ生成されるであろうものが値として扱えて欲しいということのようだ。
生成関数を通すのではなくやがて生成するのであろうものを保持してどこかに渡したい。ここで渡した先でそれを使った処理が書きたい。コードオブジェクトの話だ。

### 追記

もう少し具体的な用途で考えてみる

- パッケージ
- 関数定義
- 変数定義

基本的にはpythonのモジュールのような形で使いたい。関数の適用自体はvarDefやfuncDefを渡すイメージ？
コードではなくfunctionなのはないか？partsのようなものを作るかは悩みどころ。

### 追記

Describeというものを作った。結構色々と大変かもしれない。再実装的な感じで。
Variable,Functionって実態はImplementationなのではないか？同じ型として扱って良い？
Typeもここに含まれる？Symbolからこれが辿れれば十分なのではないか？

## go query builder

- mongo like
- sql like
- go struct

幾つかの方針が考えられる。今回はgo structの話。

### go struct

structでASTのようなものを表すというのは悪くない。一方でこれをそのまま使うのはとてもだるい。
あとはなんだろう？型を気にして値の範囲を制限しようとすると結構すぐに難しくなる。
拡張可能の意味はインストール可能みたいな意味として扱えれば良いのではないか？というような感覚がある。
これについてはどこかでまとめておきたい。はじめのうちは文字列を生成する機構として扱うだけで良いのではないか？

## query library

そういえば、mongoのquery libraryが糞ほど使いづらいと思う事があったのだった。これは完全にunexpected fieldを指定したときに結果がnilで返ってくるせい。これを防ぐにはadditionalProperties: false的な仕組みが必要になる。つまるところテーブルのフィールドの情報が必要と言うような話。

あとはlogの解析とかができるかどうかというのを見ていたのだっけ？sqlの場合にはdatabase/sqlにテキトーにフックを挟むことで実現ができそうだった。

## 全角空白について

幾つかの言語では全角空白も含めて空白扱い

- http://www.r6rs.org/final/html/r6rs/r6rs-Z-H-7.html#node_sec_4.2.3
- https://262.ecma-international.org/11.0/#prod-WhiteSpace

元々の始まりはpythonでインデントに全角空白を使ってはなぜダメか？みたいな話だった（関数名にunicodeの文字が使えるというのに）。

### pythonでの対応

実際のところ、タブを空白8文字に置き換えるだとかかなり具体的な形で記述されている。インデントとして扱うなら2文字とか文字数も気にしたほうが良い？

- https://docs.python.org/3/reference/lexical_analysis.html#indentation

### コード中の対応

少なくとも Parser/tokenizer.c のところで tabsize というフィールドが用意されていてそれが8とされている部分は発見した。

- https://github.com/Python/CPython/blob/master/Parser/tokenizer.c#L67
- https://github.com/python/cpython/blob/6086ae7fd4aeb4089282189673f9bd0cc33abf9b/Parser/tokenizer.c#L37
