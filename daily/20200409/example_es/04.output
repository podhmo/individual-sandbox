{
  "error" : {
    "root_cause" : [
      {
        "type" : "script_exception",
        "reason" : "compile error",
        "script_stack" : [
          "Similarity.cosineSimilari ...",
          "^---- HERE"
        ],
        "script" : "Similarity.cosineSimilarity(params.query_vector, doc['my_vector']) + 1.0",
        "lang" : "painless",
        "stack_trace" : "ScriptException[compile error]; nested: IllegalArgumentException[Variable [Similarity] is not defined.];\n\tat org.elasticsearch.painless.PainlessScriptEngine.convertToScriptException(PainlessScriptEngine.java:474)\n\tat org.elasticsearch.painless.PainlessScriptEngine.compile(PainlessScriptEngine.java:394)\n\tat org.elasticsearch.painless.PainlessScriptEngine.compile(PainlessScriptEngine.java:145)\n\tat org.elasticsearch.script.ScriptService.compile(ScriptService.java:358)\n\tat org.elasticsearch.search.SearchService.parseSource(SearchService.java:866)\n\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:600)\n\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:554)\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:351)\n\tat org.elasticsearch.search.SearchService.lambda$executeQueryPhase$1(SearchService.java:343)\n\tat org.elasticsearch.action.ActionListener.lambda$map$2(ActionListener.java:146)\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:63)\n\tat org.elasticsearch.action.ActionRunnable.lambda$supply$0(ActionRunnable.java:58)\n\tat org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:73)\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n\tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44)\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:692)\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat java.base/java.lang.Thread.run(Thread.java:830)\nCaused by: java.lang.IllegalArgumentException: Variable [Similarity] is not defined.\n\tat org.elasticsearch.painless.PainlessScript$Script.compile(Similarity.cosineSimilarity(params.query_vector, doc['my_vector']) + 1.0:1)\n\tat org.elasticsearch.painless.Locals.getVariable(Locals.java:138)\n\tat org.elasticsearch.painless.Locals.getVariable(Locals.java:136)\n\tat org.elasticsearch.painless.node.EVariable.analyze(EVariable.java:56)\n\tat org.elasticsearch.painless.node.PCallInvoke.analyze(PCallInvoke.java:68)\n\tat org.elasticsearch.painless.node.EBinary.analyzeAdd(EBinary.java:243)\n\tat org.elasticsearch.painless.node.EBinary.analyze(EBinary.java:79)\n\tat org.elasticsearch.painless.node.SExpression.analyze(SExpression.java:56)\n\tat org.elasticsearch.painless.node.SClass.analyze(SClass.java:194)\n\tat org.elasticsearch.painless.node.SClass.analyze(SClass.java:150)\n\tat org.elasticsearch.painless.Compiler.compile(Compiler.java:214)\n\tat org.elasticsearch.painless.PainlessScriptEngine$2.run(PainlessScriptEngine.java:389)\n\tat org.elasticsearch.painless.PainlessScriptEngine$2.run(PainlessScriptEngine.java:385)\n\tat java.base/java.security.AccessController.doPrivileged(AccessController.java:391)\n\tat org.elasticsearch.painless.PainlessScriptEngine.compile(PainlessScriptEngine.java:385)\n\t... 18 more\n"
      }
    ],
    "type" : "search_phase_execution_exception",
    "reason" : "all shards failed",
    "phase" : "query",
    "grouped" : true,
    "failed_shards" : [
      {
        "shard" : 0,
        "index" : "my_index",
        "node" : "3VWHEDYcQViq60VUiHN16g",
        "reason" : {
          "type" : "script_exception",
          "reason" : "compile error",
          "script_stack" : [
            "Similarity.cosineSimilari ...",
            "^---- HERE"
          ],
          "script" : "Similarity.cosineSimilarity(params.query_vector, doc['my_vector']) + 1.0",
          "lang" : "painless",
          "caused_by" : {
            "type" : "illegal_argument_exception",
            "reason" : "Variable [Similarity] is not defined.",
            "stack_trace" : "java.lang.IllegalArgumentException: Variable [Similarity] is not defined.\n\tat org.elasticsearch.painless.PainlessScript$Script.compile(Similarity.cosineSimilarity(params.query_vector, doc['my_vector']) + 1.0:1)\n\tat org.elasticsearch.painless.Locals.getVariable(Locals.java:138)\n\tat org.elasticsearch.painless.Locals.getVariable(Locals.java:136)\n\tat org.elasticsearch.painless.node.EVariable.analyze(EVariable.java:56)\n\tat org.elasticsearch.painless.node.PCallInvoke.analyze(PCallInvoke.java:68)\n\tat org.elasticsearch.painless.node.EBinary.analyzeAdd(EBinary.java:243)\n\tat org.elasticsearch.painless.node.EBinary.analyze(EBinary.java:79)\n\tat org.elasticsearch.painless.node.SExpression.analyze(SExpression.java:56)\n\tat org.elasticsearch.painless.node.SClass.analyze(SClass.java:194)\n\tat org.elasticsearch.painless.node.SClass.analyze(SClass.java:150)\n\tat org.elasticsearch.painless.Compiler.compile(Compiler.java:214)\n\tat org.elasticsearch.painless.PainlessScriptEngine$2.run(PainlessScriptEngine.java:389)\n\tat org.elasticsearch.painless.PainlessScriptEngine$2.run(PainlessScriptEngine.java:385)\n\tat java.base/java.security.AccessController.doPrivileged(AccessController.java:391)\n\tat org.elasticsearch.painless.PainlessScriptEngine.compile(PainlessScriptEngine.java:385)\n\tat org.elasticsearch.painless.PainlessScriptEngine.compile(PainlessScriptEngine.java:145)\n\tat org.elasticsearch.script.ScriptService.compile(ScriptService.java:358)\n\tat org.elasticsearch.search.SearchService.parseSource(SearchService.java:866)\n\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:600)\n\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:554)\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:351)\n\tat org.elasticsearch.search.SearchService.lambda$executeQueryPhase$1(SearchService.java:343)\n\tat org.elasticsearch.action.ActionListener.lambda$map$2(ActionListener.java:146)\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:63)\n\tat org.elasticsearch.action.ActionRunnable.lambda$supply$0(ActionRunnable.java:58)\n\tat org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:73)\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n\tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44)\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:692)\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat java.base/java.lang.Thread.run(Thread.java:830)\n"
          },
          "stack_trace" : "ScriptException[compile error]; nested: IllegalArgumentException[Variable [Similarity] is not defined.];\n\tat org.elasticsearch.painless.PainlessScriptEngine.convertToScriptException(PainlessScriptEngine.java:474)\n\tat org.elasticsearch.painless.PainlessScriptEngine.compile(PainlessScriptEngine.java:394)\n\tat org.elasticsearch.painless.PainlessScriptEngine.compile(PainlessScriptEngine.java:145)\n\tat org.elasticsearch.script.ScriptService.compile(ScriptService.java:358)\n\tat org.elasticsearch.search.SearchService.parseSource(SearchService.java:866)\n\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:600)\n\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:554)\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:351)\n\tat org.elasticsearch.search.SearchService.lambda$executeQueryPhase$1(SearchService.java:343)\n\tat org.elasticsearch.action.ActionListener.lambda$map$2(ActionListener.java:146)\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:63)\n\tat org.elasticsearch.action.ActionRunnable.lambda$supply$0(ActionRunnable.java:58)\n\tat org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:73)\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n\tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44)\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:692)\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat java.base/java.lang.Thread.run(Thread.java:830)\nCaused by: java.lang.IllegalArgumentException: Variable [Similarity] is not defined.\n\tat org.elasticsearch.painless.PainlessScript$Script.compile(Similarity.cosineSimilarity(params.query_vector, doc['my_vector']) + 1.0:1)\n\tat org.elasticsearch.painless.Locals.getVariable(Locals.java:138)\n\tat org.elasticsearch.painless.Locals.getVariable(Locals.java:136)\n\tat org.elasticsearch.painless.node.EVariable.analyze(EVariable.java:56)\n\tat org.elasticsearch.painless.node.PCallInvoke.analyze(PCallInvoke.java:68)\n\tat org.elasticsearch.painless.node.EBinary.analyzeAdd(EBinary.java:243)\n\tat org.elasticsearch.painless.node.EBinary.analyze(EBinary.java:79)\n\tat org.elasticsearch.painless.node.SExpression.analyze(SExpression.java:56)\n\tat org.elasticsearch.painless.node.SClass.analyze(SClass.java:194)\n\tat org.elasticsearch.painless.node.SClass.analyze(SClass.java:150)\n\tat org.elasticsearch.painless.Compiler.compile(Compiler.java:214)\n\tat org.elasticsearch.painless.PainlessScriptEngine$2.run(PainlessScriptEngine.java:389)\n\tat org.elasticsearch.painless.PainlessScriptEngine$2.run(PainlessScriptEngine.java:385)\n\tat java.base/java.security.AccessController.doPrivileged(AccessController.java:391)\n\tat org.elasticsearch.painless.PainlessScriptEngine.compile(PainlessScriptEngine.java:385)\n\t... 18 more\n"
        }
      }
    ],
    "stack_trace" : "Failed to execute phase [query], all shards failed; shardFailures {[3VWHEDYcQViq60VUiHN16g][my_index][0]: RemoteTransportException[[69cbbd76e26e][172.19.0.2:9300][indices:data/read/search[phase/query]]]; nested: ScriptException[compile error]; nested: IllegalArgumentException[Variable [Similarity] is not defined.]; }\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:545)\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:306)\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseDone(AbstractSearchAsyncAction.java:574)\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.onShardFailure(AbstractSearchAsyncAction.java:386)\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.access$200(AbstractSearchAsyncAction.java:66)\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction$1.onFailure(AbstractSearchAsyncAction.java:242)\n\tat org.elasticsearch.action.search.SearchExecutionStatsCollector.onFailure(SearchExecutionStatsCollector.java:73)\n\tat org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:59)\n\tat org.elasticsearch.action.search.SearchTransportService$ConnectionCountingHandler.handleException(SearchTransportService.java:423)\n\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1130)\n\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.processException(TransportService.java:1239)\n\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1213)\n\tat org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:60)\n\tat org.elasticsearch.action.support.ChannelActionListener.onFailure(ChannelActionListener.java:56)\n\tat org.elasticsearch.action.ActionListener$1.onFailure(ActionListener.java:71)\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:65)\n\tat org.elasticsearch.action.ActionRunnable.lambda$supply$0(ActionRunnable.java:58)\n\tat org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:73)\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n\tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44)\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:692)\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat java.base/java.lang.Thread.run(Thread.java:830)\nCaused by: ScriptException[compile error]; nested: IllegalArgumentException[Variable [Similarity] is not defined.];\n\tat org.elasticsearch.painless.PainlessScriptEngine.convertToScriptException(PainlessScriptEngine.java:474)\n\tat org.elasticsearch.painless.PainlessScriptEngine.compile(PainlessScriptEngine.java:394)\n\tat org.elasticsearch.painless.PainlessScriptEngine.compile(PainlessScriptEngine.java:145)\n\tat org.elasticsearch.script.ScriptService.compile(ScriptService.java:358)\n\tat org.elasticsearch.search.SearchService.parseSource(SearchService.java:866)\n\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:600)\n\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:554)\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:351)\n\tat org.elasticsearch.search.SearchService.lambda$executeQueryPhase$1(SearchService.java:343)\n\tat org.elasticsearch.action.ActionListener.lambda$map$2(ActionListener.java:146)\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:63)\n\t... 9 more\nCaused by: java.lang.IllegalArgumentException: Variable [Similarity] is not defined.\n\tat org.elasticsearch.painless.PainlessScript$Script.compile(Similarity.cosineSimilarity(params.query_vector, doc['my_vector']) + 1.0:1)\n\tat org.elasticsearch.painless.Locals.getVariable(Locals.java:138)\n\tat org.elasticsearch.painless.Locals.getVariable(Locals.java:136)\n\tat org.elasticsearch.painless.node.EVariable.analyze(EVariable.java:56)\n\tat org.elasticsearch.painless.node.PCallInvoke.analyze(PCallInvoke.java:68)\n\tat org.elasticsearch.painless.node.EBinary.analyzeAdd(EBinary.java:243)\n\tat org.elasticsearch.painless.node.EBinary.analyze(EBinary.java:79)\n\tat org.elasticsearch.painless.node.SExpression.analyze(SExpression.java:56)\n\tat org.elasticsearch.painless.node.SClass.analyze(SClass.java:194)\n\tat org.elasticsearch.painless.node.SClass.analyze(SClass.java:150)\n\tat org.elasticsearch.painless.Compiler.compile(Compiler.java:214)\n\tat org.elasticsearch.painless.PainlessScriptEngine$2.run(PainlessScriptEngine.java:389)\n\tat org.elasticsearch.painless.PainlessScriptEngine$2.run(PainlessScriptEngine.java:385)\n\tat java.base/java.security.AccessController.doPrivileged(AccessController.java:391)\n\tat org.elasticsearch.painless.PainlessScriptEngine.compile(PainlessScriptEngine.java:385)\n\t... 18 more\n"
  },
  "status" : 400
}
