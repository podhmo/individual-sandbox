# process managerがディレクトリを模したUIになっているとしたら

以下の２つの要求が自分の中にある模様

- supervisordの代わりを作りたい
- 設定されたパスに対してデータを投げ込むパイプラインを作りたい

特に後者で念頭においているのは、コードが書けない人。

一方で何かの操作をやるたびにアプリを作るというのは筋が悪いような気がしている。例えば、自分で使う分にはコマンド1つ作れば良いだけのところを、シェルに触ることに慣れていない人に届けようと思った時点で、そのコマンドを作成する以上の追加コストを払う必要が出てくることがある。加えてそのような一品者のアプリは他のものとの協調動作というものに欠けている。

## プロセス管理

パイプラインを作るという状況は少し飛躍しすぎているのでとりあえずプロセスを管理するという状況をイメージしてみることにする。利用したいものというのは2つの可能性がありdaemon的なものとapp的なもの。app的なものの管理は単純で動かしたらそのプロセスの標準入出力を管理する作業とシグナルを送る作業を良い感じにしてくれれば良い。daemon的なものと言う言葉は適切ではないかもしれない。どういうものが欲しいかというとイベントのpublisherないしはsubscriber(ただし自身で直接完結したものというものも考えられてその場合にはイベントではなく直接の何らかの操作ということになる)。

プロセスを管理したいと言った場合に全体を俯瞰しやすいようにuiを作るという考えもあるかもしれない。それはそれで便利ではあるのかもしれないけれど。個人的には可能ならば追加のコストが0という状況になっていて欲しい。ここでいう追加のコストとというのはuiを構成するために消費するコストのこと。例えばあるgo製のツールはweb uiを持っていて、自身で立ち上げたプロセス１つに対して１つのweb socketのコネクションを貼るというような構成になっていた。そしてそのuiを使うことが強制されるというような形になっており、一気に数十程度のプロセスを立ち上げた場合に、PC上で何も操作ができない状態になり解消まで1分くらい待つ必要があるというような状況になっていた。このようなことは避けたい。

## ツール + 設定

### command?

例えば、ブログに記事を投稿するツールがあるとする。このツールは設定を読み込み、その設定にはどのブログに投稿したいかという情報が含まれている。なので基本的には以下の様なコマンドで渡されたファイルを投稿するという形になる(例えばmarkdownで書かれたファイルを渡す)。

```console
$ post-article -c ~/.config/publish/config.json <filename>
```

このツールで行いたい作業は記事の投稿や追記・編集。加えて下書きにしたかったりと言うようなオプションがつくかもしれない。行われる作業は概ねコマンド的な操作。何らかの外部サービスに対してデータを送信するような処理。

今回の例に沿う話をするなら、ここで欲しいのは、自分の手元の環境と送信先外部サービスとの同期。つまり手元にブログ用の記事のテキストが作られたのなら、そのテキストを対象のブログに投稿したい。

ちょっと考えなければいけないのは、設定にプラスしてオプションとして渡される引数の扱い。シェル以外から触ることを念頭に置くのなら。できる操作は何かの意味をもしたアイコンのクリックとファイルのD&D程度。(右クリックで開かれるコンテキストメニューに追加というのは少し環境の細部に入り込みすぎていて辛そうな気がしている)

### query?

逆方向のツールの存在もあるかもしれない。逆方向というのは、先程の例のように外部サービスへの出力になるのではなく、外部サービスから何らかの情報を取得するというような何か。出力ではなく入力。ちなみに、ツールという言葉を意識的に使っていて、アプリは状態を持つもののツールは状態をもたない。アプリは何らかの処理を複合的に行えるもののツールは単発的な操作以外行えない。と言うようなものを指している。

例えばどういう例があるだろう。何らかのサービスから条件に合致するデータを集めてくるみたいなコマンドがあったりするのかもしれない。結果は標準出力に出力される。あるいはファイルに保存される。

```
$ search-xxx -c ~/.config/xxx/config.json <query> | tee data/<query>.json
```

こちらでも行いたいのは情報の同期。ある外の世界(ここでは手元の環境の外を指している)で何らかの事象が発生した時に、その事象に関する事柄を集めて認識したい。例に沿うなら、何らかの興味のある事柄を監視していてその事柄に対する新たな情報が手に入ったのならば然るべき形で保存しておきたいみたいな形になる。

ちょっと考えなければいけないのは、出力された情報の扱い。通常のコマンドでの利用を考えるなら単にコンソールに出力されれば十分であったのだけれど。そうも言っていられない。加えてパイプを繋げば次に行いたい何かに情報を渡せていたのだけれど。それも何らかの設定を用意する必要がある。難しいのはデバッグ。一続きのタスクフローのようなものをGUI上設定できその依存関係に応じて情報が伝搬していくという仕組みを作ることはできるのだけれど。それは単に露出したシステムを作るのと変わらず。構成するネットワークの一部だけを取り出してごく一部の操作だけ実行ということが手軽にできるのか？というような怪しさがある。
